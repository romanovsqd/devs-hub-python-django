{% extends "base.html" %}
{% load static %}
{% load deck_tags %}


{% block title %}
  {% if is_owner %}Мои наборы карточек{% else %}Наборы карточек {{ user.username }}{% endif %}
{% endblock title %}

{% block content %}

  <h1>
    {% if is_owner %}Мои наборы карточек{% else %}Наборы карточек {{ user.username }}{% endif %}
  </h1>

  <div>
    <form method="get">
      <input type="text" name="query" placeholder="Циклы в python" value={{ request.GET.query|default:'' }}>
      <select name="sort_by">
        <option value="newest" {% if request.GET.sort_by == 'newest' %}selected{% endif %}>Сначала новые</option>
        <option value="oldest" {% if request.GET.sort_by == 'oldest' %}selected{% endif %}>Сначала старые</option>
      </select>
      <button type="submit">Поиск</button>
    </form>
  </div>


  <ul>
    {% for deck in user_decks %}
      <li>
        {% render_deck deck %}
        {% if is_owner %}
          <form action="{% url "deck_toggle_study" deck.id %}" method="post" data-js-toggle-save-form>
            {% csrf_token %}
            <button type="submit" data-js-toggle-button>
              {% if deck.id not in studying_decks_ids %}
                Добавить в изучаемые
              {% else %}
                Удалить из изучаемых
              {% endif %}
            </button>
          </form>
        {% endif %}
      </li>
    {% empty %}
      <li>
        Наборов карточек нету
      </li>
    {% endfor %}
  </ul>

<div>
  {% if user_decks.has_previous %}
    <a href="?page={{ user_decks.previous_page_number }}&query={{ query }}&sort_by={{ sort_by }}">Назад</a>
  {% endif %}

  <span>
    Страница {{ user_decks.number }} из {{ user_decks.paginator.num_pages }}
  </span>

  {% if user_decks.has_next %}
    <a href="?page={{ user_decks.next_page_number }}&query={{ query }}&sort_by={{ sort_by }}">Вперёд</a>
  {% endif %}
</div>

{% endblock content %}

{% block scripts %}
  <script src="{% static "js/toggle_form_state.js" %}"></script>
{% endblock scripts %}
